<!doctype html><html lang=en-us prefix="og: http://ogp.me/ns# fb: http://ogp.me/ns/fb#">
<head>
<meta charset=utf-8>
<script async src="https://www.googletagmanager.com/gtag/js?id=G-CDK4087KM8"></script>
<script>var doNotTrack=!1;if(!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag('js',new Date),gtag('config','G-CDK4087KM8',{anonymize_ip:!1})}</script>
<meta charset=utf-8>
<meta http-equiv=x-ua-compatible content="IE=edge,chrome=1">
<meta name=HandheldFriendly content="True">
<meta name=MobileOptimized content="320">
<meta name=viewport content="width=device-width,initial-scale=1">
<link rel=apple-touch-icon sizes=180x180 href=https://crmejia.github.io/apple-touch-icon.png>
<link rel=icon type=image/png sizes=32x32 href=https://crmejia.github.io/favicon-32x32.png>
<link rel=icon type=image/png sizes=16x16 href=https://crmejia.github.io/favicon-16x16.png>
<link rel=manifest href=https://crmejia.github.io/site.webmanifest>
<link rel=mask-icon href=https://crmejia.github.io/safari-pinned-tab.svg color=#5bbad5>
<meta name=msapplication-TileColor content="#da532c">
<meta name=theme-color content="#ffffff">
<meta name=description content="I ran out of credit for Google Cloud. Turns out running a cluster is quite expensive. For the sake of having a blog while I keep learning about kubernetes and other technologies I decided to go with a simpler(and cheaper) approach to blogging">
<meta name=keywords content="AWS,
bitnami,
https,
let's encrypt,
WordPress,
">
<meta property="og:title" content="AWS EC2 + Bitnami and HTTPS w/Let's Encrypt">
<meta property="og:description" content="I ran out of credit for Google Cloud. Turns out running a cluster is quite expensive. For the sake of having a blog while I keep learning about kubernetes and other technologies I decided to go with a simpler(and cheaper) approach to blogging">
<meta property="og:type" content="article">
<meta property="og:url" content="https://crmejia.github.io/posts/aws-ec2-bitnami-and-https-wlets-encrypt/"><meta property="article:section" content="posts">
<meta property="article:published_time" content="2017-05-15T20:07:06+00:00">
<meta property="article:modified_time" content="2017-05-15T20:07:06+00:00">
<meta property="og:site_name" content="Crismar.Me">
<meta name=twitter:card content="summary">
<meta name=twitter:title content="AWS EC2 + Bitnami and HTTPS w/Let's Encrypt">
<meta name=twitter:description content="I ran out of credit for Google Cloud. Turns out running a cluster is quite expensive. For the sake of having a blog while I keep learning about kubernetes and other technologies I decided to go with a simpler(and cheaper) approach to blogging">
<meta itemprop=name content="AWS EC2 + Bitnami and HTTPS w/Let's Encrypt">
<meta itemprop=description content="I ran out of credit for Google Cloud. Turns out running a cluster is quite expensive. For the sake of having a blog while I keep learning about kubernetes and other technologies I decided to go with a simpler(and cheaper) approach to blogging"><meta itemprop=datePublished content="2017-05-15T20:07:06+00:00">
<meta itemprop=dateModified content="2017-05-15T20:07:06+00:00">
<meta itemprop=wordCount content="830">
<meta itemprop=keywords content="AWS,bitnami,https,let's encrypt,WordPress,">
<title>AWS EC2 + Bitnami and HTTPS w/Let's Encrypt || Crismar.Me</title>
<link rel=canonical href=https://crmejia.github.io/posts/aws-ec2-bitnami-and-https-wlets-encrypt/>
<link rel=stylesheet href=/css/reboot.css>
<link rel=stylesheet href=/css/style.css>
<link rel=stylesheet href=/css/syntax.css>
<script type=text/javascript src=/js/main.js></script>
<link href="https://fonts.googleapis.com/css?family=Lora&display=swap" rel=stylesheet>
<link rel="shortcut icon" href=/favicon.ico type=image/x-icon>
<link rel=apple-touch-icon href=/apple-touch-icon.png>
</head>
<body lang=en-us>
<div class="navbar nav-bkg drop-shadow">
<nav class="content-container pagewide-bar-padding">
<span class=divider>/ </span>
<a href=/>Crismar.Me</a>
<span class=divider>/ </span>
<a href=/posts/>Posts</a>
<ul class="list-unstyled right-links">
<li>
<a href=/about/>
<span class=post-title>about</span>
</a>
</li>
<li>
<a href=/posts/>
<span class=post-title>blog</span>
</a>
</li>
<li>
<a href=/consulting/>
<span class=post-title>consulting</span>
</a>
</li>
</ul>
</nav>
</div>
<article id=main class="content-container look-sheet article-pad-v" itemscope itemtype=https://schema.org/Article>
<meta itemprop=author content>
<meta itemprop=publisher content>
<meta itemprop=image content>
<h1 itemprop=name id=title>AWS EC2 + Bitnami and HTTPS w/Let's Encrypt</h1>
<meta itemprop=headline content="AWS EC2 + Bitnami and HTTPS w/Let's Encrypt">
<div class=post-tags>
<a href=https://crmejia.github.io/tags/aws/>#AWS</a>&nbsp;
<a href=https://crmejia.github.io/tags/bitnami/>#bitnami</a>&nbsp;
<a href=https://crmejia.github.io/tags/https/>#https</a>&nbsp;
<a href=https://crmejia.github.io/tags/lets-encrypt/>#let's encrypt</a>&nbsp;
<a href=https://crmejia.github.io/tags/wordpress/>#WordPress</a>&nbsp;
</div>
<div class=post-date><span itemprop=datePublished>May 15, 2017</span></div>
<meta itemprop=dateModified content="May 15, 2017">
<div itemprop=articleBody id=content class="article-body margin-top-2em">
<p>I ran out of credit for Google Cloud. Turns out running a cluster is quite expensive. For the sake of having a blog while I keep learning about kubernetes and other technologies I decided to go with a simpler(and cheaper) approach to blogging.</p>
<h2 id=enter-aws--bitnami>Enter AWS + Bitnami</h2>
<p>I chose to start AWS free trial and create a blog using the prepacked Bitnami solution. This deployment runs on a good ol’ VM and is cheap. Also, I get the chance to familiarize myself with the AWS stack which is useful since I could create a k8s cluster down the line and play with it.</p>
<p>Bitnami pre-packs WordPress, MariaDB, Apache HTTP Server, and some neat tools to facilitate a wordpress installation and setup. It’s a straightforward stack to set up and there is some fantastic <a href=https://docs.bitnami.com/aws/get-started-marketplace>documentation available</a>.</p>
<p>I reached out to a colleague regarding my domain issue. Turns out I was using a forward on my A record hence the blog’s IP showed instead of the domain. After modifying the record I was able to have my domain show up.</p>
<h2 id=https-with-lets-encrypt>HTTPS with Let’s Encrypt</h2>
<p>Now that the blog is up I can work to enable HTTPS which is something I’ve been looking to do for a while. First, we need to get a certificate from a Certificate Authority(CA) which can be expensive see <a href="https://news.ycombinator.com/item?id=530600">here</a> and <a href=https://security.stackexchange.com/questions/93624/why-are-there-very-expensive-and-cheap-ssl-same-type-certificates>here</a>. Fortunately, we can get a free certificate from <a href=https://letsencrypt.org/>Let’s Encrypt</a> that provides just what we need to enable HTTPS.</p>
<p>There are straightforward instructions on how to get a certificate using <a href=https://certbot.eff.org/>EFF’s Certbot</a> if you have shell access. For Bitnami the process is a bit different since there are tools to manage certificates. We still need to install the Certbot but the certificates need to be put in the corresponding directories within the bitnami app. Following the <a href=https://docs.bitnami.com/aws/components/apache/#how-to-install-the-lets-encrypt-client>guide</a> from Bitnami docs here are my steps:</p>
<p>First we need to install git and certbot. In the AWS instance:</p>
<pre tabindex=0><code>$sudo sudo apt-get install git  
$cd /tmp  
$git clone https://github.com/certbot/certbot  
$cd cerbot  
$./certbot-auto
</code></pre><p>At the end of the installation we get the message</p>
<blockquote>
<p>Failed to find executable apache2ctl in PATH: /opt/bitnami/varnish/bin:/opt/bitnami/sqlite/bin:/opt/bitnami/php/bin:/opt/bitnami/mysql/bin:/opt/bitnami/apache2/bin:/opt/bitnami/common/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/snap/bin</p>
</blockquote>
<blockquote>
<p>Certbot doesn’t know how to automatically configure the web server on this system. However, it can still get a certificate for you. Please run “certbot-auto certonly” to do so. You’ll need to manually configure your web server to use the resulting certificate.</p>
</blockquote>
<p>Run again, this time:</p>
<p><code>$./certbot-auto certonly --webroot -w /opt/bitnami/apps/wordpress/htdocs/ -d crismar.me</code></p>
<p>After accepting the terms and providing our email we get a certificate! Now we must install it on the server. The guide we are following doesn’t state this but the apache server on this wordpress pack has a <a href=https://docs.bitnami.com/aws/apps/wordpress/#how-to-enable-https-support-with-ssl-certificates>dummy cert</a> that we need to replace with ours. The guide creates symbolic links to the certs instead of copying them, my guess is that this is to automate the cert renew process since the certs expire every 3 months. </p>
<pre tabindex=0><code>$cd /opt/bitnami/apache2/conf/&lt;br&gt;&lt;/br&gt;
$rm server.crt&lt;br&gt;&lt;/br&gt;
$rm server.key&lt;br&gt;&lt;/br&gt;
$sudo ln -s /etc/letsencrypt/live/crismar.me/fullchain.pem server.crt&lt;br&gt;&lt;/br&gt;
$sudo ln -s /etc/letsencrypt/live/crismar.me/privkey.pem server.key
</code></pre><p>Then add the following lines to the <code>/opt/bitnami/apps/wordpress/conf/httpd-prefix.conf</code> to force https:</p>
<p><code>RewriteEngine On&lt;br>&lt;/br>RewriteCond %{HTTPS} !=on&lt;br>&lt;/br>RewriteRule ^/(.*) https://%{SERVER_NAME}/$1 [R,L]</code></p>
<p>And once again modify the wp config file to point to https:</p>
<pre tabindex=0><code>$vim /opt/bitnami/apps/wordpress/htdocs/wp-config.php define('WP_SITEURL', 'https://crismar.me/');&lt;br&gt;&lt;/br&gt;
define('WP_HOME', 'https://crismar.me/');
</code></pre><p>A small digression. In the previous post <a href=/posts/let-there-be-a-domain/>Let There Be a Domain</a>, I explained how I broke the blog by changing these variables. At the time I didn’t quite understand what went wrong but now I finally get it. Basically, the goal of these variables is to generate the URLs of the blog. That is all the links to all the pages and posts. In our case we want these links to be a domain rather than an IP. Turns out since my DNS was (mis)configured to forward I had a loop between my server and the DNS server that never resolved. My domain pointed to the IP but WordPress pointed to my domain. All in all, now I have a better understanding of DNS and servers and how to connect to pods in a cluster.</p>
<p>Finally, lets restart Apache httpd:</p>
<p><code>$sudo /opt/bitnami/ctlscript.sh restart apache</code></p>
<p>And the blog should be all green locked! Almost. My login page and admin console are but some pages are not.</p>
<p>Turns out, I have some <em>mixed content</em>: </p>
<blockquote>
<p>Mixed Content: The page at &lsquo;<a href="https://crismar.me/2017/04/16/blog-day-1-site-unavailable/'">https://crismar.me/2017/04/16/blog-day-1-site-unavailable/'</a> was loaded over HTTPS, but requested an insecure image &lsquo;<a href="http://i.imgur.com/oXki5DH.png'">http://i.imgur.com/oXki5DH.png'</a>. This content should also be served over HTTPS.</p>
</blockquote>
<p>In other words, my resources have to be HTTPS too! Let’s edit the post(s) and change that. That did it. Green!</p>
<h2 id=conclusion>Conclusion</h2>
<p>This time I had the chance to familiarize myself with AWS and to explore how some companies such as Bitnami work to make setup and installation simple. Also, I got around to setting up HTTPS and Certificates and learned what it takes to make a server secure. Now that the blog is rolling(in a secure HTTPS way I must add) and stable. I plan to go back to kubernetes and create a cluster from scratch. Until then!</p>
</div>
</article>
<div class="nav-bkg-50 content-container-narrow-pad bottom-links text-0p75 drop-shadow">
<nav class=flex-row>
<a href=https://crmejia.github.io/posts/let-there-be-a-domain/ class="flex-row v-center no-underline" style=max-width:45%>
<span class=text-1p5>←</span>&nbsp;<span class=re-underline>Previous: Let There be a Domain</span>
</a>
<a href=https://crmejia.github.io/posts/june-2017-journal-what-ive-been-up-to/ class="flex-row v-center no-underline" style=max-width:45%>
<span class=re-underline>Next: June 2017 Journal: What I've Been up to</span>&nbsp;<span class=text-1p5>→</span>
</a>
</nav>
</div>
</body>
</html>